module.exports=[20864,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(58652),e=a.i(50944),f=a.i(36770),g=a.i(210);function h({onBack:a,orderId:c}){return(0,b.jsxs)("div",{className:"flex items-center gap-6 mb-8",children:[(0,b.jsx)("button",{onClick:()=>{window.confirm("Apakah Anda yakin ingin membatalkan pesanan ini?")&&a()},className:"p-3 hover:bg-gray-100 rounded-full transition-colors",title:"Batalkan pesanan dan kembali",children:(0,b.jsx)(g.ArrowLeft,{className:"w-8 h-8 text-gray-700"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Pembayaran"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Order #",c]})]})]})}function i({itemName:a,totalPrice:c,formatPrice:d}){return(0,b.jsx)("div",{className:"border-b-2 border-gray-200 pb-6 mb-8",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:a}),(0,b.jsx)("span",{className:"text-2xl font-bold text-red-600",children:d(c)})]})})}var j=a.i(96221),k=a.i(92e3);function l({orderId:a}){let[d,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(!1);(0,c.useEffect)(()=>{l()},[]);let l=async()=>{try{let a=await fetch("http://localhost:5000/api/business-info"),b=await a.json();b.success&&b.data&&b.data.qris_image?(e(b.data.qris_image),i(!0)):i(!1)}catch(a){console.error("Error fetching QR code:",a),i(!1)}finally{g(!1)}};return(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-6 mb-8",children:[(0,b.jsx)("div",{className:"bg-white p-4 rounded-2xl shadow-lg border-4 border-gray-200 overflow-hidden",children:(0,b.jsx)("div",{className:"w-64 h-64 relative overflow-hidden flex items-center justify-center bg-gray-50",children:f?(0,b.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,b.jsx)(j.Loader2,{className:"w-8 h-8 animate-spin text-orange-500"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Memuat QR Code..."})]}):h&&d?(0,b.jsx)("img",{src:d,alt:"QR Code Pembayaran",className:"w-full h-full object-contain"}):(0,b.jsxs)("div",{className:"text-center p-6",children:[(0,b.jsx)(k.AlertCircle,{className:"w-16 h-16 mx-auto text-gray-400 mb-3"}),(0,b.jsx)("p",{className:"text-gray-600 font-semibold mb-2",children:"QR Code Belum Tersedia"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Admin belum mengupload QRIS"})]})})}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-gray-600 text-sm mb-1",children:"ORDER ID"}),(0,b.jsx)("p",{className:"text-gray-900 font-mono font-bold text-lg tracking-wider",children:a})]}),!f&&!h&&(0,b.jsx)("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-xl p-4 max-w-md",children:(0,b.jsxs)("p",{className:"text-sm text-amber-800 text-center",children:["âš ï¸ ",(0,b.jsx)("strong",{children:"QR Code belum tersedia."}),(0,b.jsx)("br",{}),"Silakan gunakan opsi ",(0,b.jsx)("strong",{children:'"Konfirmasi via WhatsApp"'})," di bawah untuk pembayaran alternatif."]})}),!f&&h&&d&&(0,b.jsx)("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 max-w-md",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800 text-center",children:["ðŸ“± ",(0,b.jsx)("strong",{children:"Scan QR Code"})," menggunakan aplikasi e-wallet Anda (GoPay, OVO, DANA, ShopeePay, dll)"]})})]})}let m=(0,a.i(70106).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var n=a.i(16201),o=a.i(33508);function p({proofUploaded:a,proofPreview:c,uploading:d,uploadError:e,onImageSelect:f,onUploadProof:g,onRemoveImage:h}){return(0,b.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl p-6 mb-8",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(m,{className:"w-6 h-6 text-green-600"}),"ðŸ“¸ Upload Bukti Pembayaran"]}),a?(0,b.jsxs)("div",{className:"bg-green-100 border-2 border-green-300 rounded-xl p-6 text-center",children:[(0,b.jsx)(n.CheckCircle,{className:"w-16 h-16 text-green-600 mx-auto mb-3"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-green-800 mb-2",children:"âœ… Bukti Pembayaran Berhasil Diupload!"}),(0,b.jsx)("p",{className:"text-green-700 text-sm",children:"Admin kami akan segera memverifikasi pembayaran Anda."})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 flex items-start gap-3",children:[(0,b.jsx)(k.AlertCircle,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-semibold mb-1",children:"ðŸ“Œ Setelah melakukan pembayaran via QRIS:"}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-xs ml-2",children:[(0,b.jsx)("li",{children:"Screenshot bukti pembayaran dari aplikasi e-wallet"}),(0,b.jsx)("li",{children:"Upload screenshot tersebut di form ini"}),(0,b.jsx)("li",{children:'Klik tombol "Upload Bukti Pembayaran"'}),(0,b.jsx)("li",{children:"Tunggu hingga proses upload selesai"})]})]})]}),c?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:c,alt:"Preview Bukti Pembayaran",className:"w-full h-64 object-contain rounded-xl bg-gray-100 border-2 border-green-200"}),(0,b.jsx)("button",{onClick:h,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors shadow-lg",disabled:d,children:(0,b.jsx)(o.X,{className:"w-5 h-5"})})]}):(0,b.jsx)("div",{className:"border-3 border-dashed border-green-300 rounded-xl p-8 text-center bg-white hover:bg-green-50 transition-colors cursor-pointer",children:(0,b.jsxs)("label",{htmlFor:"proof-upload",className:"cursor-pointer block",children:[(0,b.jsx)(m,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-700 font-semibold mb-2",children:"Klik untuk pilih gambar"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"atau drag & drop file di sini"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Format: JPG, PNG (Maks. 10MB)"}),(0,b.jsx)("input",{id:"proof-upload",type:"file",accept:"image/*",onChange:f,className:"hidden"})]})}),e&&(0,b.jsxs)("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4 flex items-start gap-3",children:[(0,b.jsx)(k.AlertCircle,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),(0,b.jsx)("p",{className:"text-red-800 text-sm font-medium",children:e})]}),c&&!a&&(0,b.jsx)("button",{onClick:g,disabled:d,className:"w-full bg-gradient-to-r from-green-600 to-green-500 text-white font-bold text-lg py-4 rounded-xl hover:from-green-700 hover:to-green-600 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-3 disabled:bg-gray-400 disabled:cursor-not-allowed",children:d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"w-6 h-6 animate-spin"}),"Mengupload..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m,{className:"w-6 h-6"}),"Upload Bukti Pembayaran"]})}),(0,b.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:(0,b.jsxs)("p",{className:"text-sm text-amber-800 text-center",children:[(0,b.jsx)("strong",{children:"ðŸ’¡ Opsional:"})," Jika Anda ingin langsung konfirmasi via WhatsApp atau mengalami kesulitan upload, Anda bisa skip langkah ini dan langsung hubungi admin."]})})]})]})}var q=a.i(45222);function r({onWhatsAppConfirm:a,onDirectContinue:c,proofUploaded:d}){return(0,b.jsxs)("div",{className:"space-y-6 mb-8",children:[(0,b.jsxs)("div",{className:"relative py-4",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("div",{className:"w-full border-t-2 border-gray-200"})}),(0,b.jsx)("div",{className:"relative flex justify-center",children:(0,b.jsx)("span",{className:"bg-white px-4 text-sm font-semibold text-gray-500",children:"Pilih Cara Konfirmasi"})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("button",{onClick:c,disabled:!d,className:`w-full font-bold text-lg py-5 rounded-2xl transition-all shadow-lg flex items-center justify-center gap-3 transform ${d?"bg-gradient-to-r from-green-600 to-green-500 text-white hover:from-green-700 hover:to-green-600 hover:shadow-xl hover:scale-[1.02]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[(0,b.jsx)(n.CheckCircle,{className:"w-6 h-6"}),"Lanjutkan ke Halaman Validasi"]}),(0,b.jsx)("p",{className:"text-center text-sm text-gray-600",children:d?"âœ… Bukti pembayaran sudah diupload, silakan lanjut untuk validasi":"âš ï¸ Upload bukti pembayaran terlebih dahulu untuk melanjutkan"})]}),(0,b.jsxs)("div",{className:"relative py-2",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,b.jsx)("div",{className:"relative flex justify-center",children:(0,b.jsx)("span",{className:"bg-white px-4 text-xs font-medium text-gray-400",children:"ATAU"})})]}),(0,b.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(k.AlertCircle,{className:"w-6 h-6 text-blue-600 flex-shrink-0 mt-1"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-blue-900 text-base mb-1",children:"âš ï¸ Mengalami Masalah dengan QRIS?"}),(0,b.jsx)("p",{className:"text-blue-800 text-sm leading-relaxed",children:"Jika Anda kesulitan melakukan pembayaran via QRIS, hubungi admin kami untuk mendapatkan metode pembayaran alternatif seperti:"}),(0,b.jsxs)("ul",{className:"mt-2 space-y-1 text-blue-800 text-sm",children:[(0,b.jsx)("li",{children:"ðŸ’³ Transfer Bank (BCA, BRI, Mandiri, dll)"}),(0,b.jsx)("li",{children:"ðŸ’µ Pembayaran Cash (COD)"}),(0,b.jsx)("li",{children:"ðŸ“± E-Wallet lainnya (OVO, GoPay, dll)"})]})]})]}),(0,b.jsxs)("button",{onClick:a,className:"w-full bg-gradient-to-r from-green-600 to-green-500 text-white font-bold text-base py-4 rounded-xl hover:from-green-700 hover:to-green-600 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-3",children:[(0,b.jsx)(q.MessageCircle,{className:"w-5 h-5"}),"Hubungi Admin untuk Bantuan"]}),(0,b.jsx)("div",{className:"bg-white/70 rounded-lg p-3",children:(0,b.jsx)("p",{className:"text-xs text-blue-800 text-center font-medium",children:"âš¡ Admin biasanya merespons dalam 5-10 menit"})})]})]})}function s({totalPrice:a,formatPrice:c}){return(0,b.jsxs)("div",{className:"mt-8 p-6 bg-amber-50 rounded-2xl border-2 border-amber-200",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-900 mb-3 text-lg",children:"ðŸ“‹ Cara Pembayaran:"}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-2 text-gray-700 text-sm",children:[(0,b.jsx)("li",{children:"Scan QR Code di atas menggunakan aplikasi e-wallet Anda"}),(0,b.jsxs)("li",{children:["Masukkan nominal pembayaran: ",(0,b.jsx)("span",{className:"font-bold text-red-600",children:c(a)})]}),(0,b.jsx)("li",{children:"Screenshot bukti transfer dan upload di form di atas"}),(0,b.jsxs)("li",{children:["Pilih ",(0,b.jsx)("span",{className:"font-semibold",children:'"Konfirmasi via WhatsApp"'})," untuk verifikasi cepat atau ",(0,b.jsx)("span",{className:"font-semibold",children:'"Lanjutkan"'})," untuk melanjutkan tanpa WhatsApp"]}),(0,b.jsx)("li",{children:"Tunggu konfirmasi dari admin kami"})]})]})}function t(){let a=(0,e.useRouter)(),g=(0,e.useSearchParams)(),[j,k]=(0,c.useState)({itemName:"Pempek",totalPrice:0,orderId:"",customerName:"Customer"}),[m,n]=(0,c.useState)([]),[o,q]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(null);(0,c.useEffect)(()=>{let b=g.get("item")||sessionStorage.getItem("payment_item_name"),c=parseFloat(g.get("total")||sessionStorage.getItem("payment_total")||"0"),d=g.get("orderId")||sessionStorage.getItem("payment_order_id"),e=g.get("customer")||sessionStorage.getItem("payment_customer_name");if(console.log("Order Details:",{orderId:d,itemName:b,totalPrice:c,customerName:e}),!d||!b||0===c){alert("Tidak ada data pesanan. Silakan pesan terlebih dahulu."),a.push("/order");return}k({itemName:b||"Pempek",totalPrice:c,orderId:d,customerName:e||"Customer"});let f=localStorage.getItem("pempek_cart_backup");f&&n(JSON.parse(f)),sessionStorage.setItem("payment_item_name",b||""),sessionStorage.setItem("payment_total",c.toString()),sessionStorage.setItem("payment_order_id",d),sessionStorage.setItem("payment_customer_name",e||""),B(d)},[g,a]);let B=async a=>{try{if(!a||""===a||isNaN(Number(a)))return void console.warn("Invalid order ID:",a);let b=await f.orderAPI.getById(a);b&&b.payment_proof&&y(!0)}catch(a){console.log("Could not check existing proof:",a.message)}},C=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a).replace("IDR","Rp"),D=async()=>{try{if(console.log("ðŸ”„ Cancelling order and restoring cart..."),m.length>0&&(localStorage.setItem("pempek_cart",JSON.stringify(m)),window.dispatchEvent(new Event("cartUpdated")),console.log("Cart restored:",m)),j.orderId)try{let a=localStorage.getItem("adminToken");a?(await f.orderAPI.updateStatus(j.orderId,"cancelled",a),console.log("âœ… Order cancelled in backend")):console.log("âš ï¸ No admin token, order will remain pending")}catch(a){console.log("âš ï¸ Could not cancel order in backend:",a)}E(),alert("Pesanan dibatalkan!\n\nItem telah dikembalikan ke keranjang Anda.\nAnda bisa melanjutkan belanja atau checkout ulang."),a.push("/cart")}catch(a){console.error("âŒ Error cancelling order:",a),alert("Gagal membatalkan pesanan. Silakan hubungi admin.")}},E=()=>{console.log("ðŸ§¹ Clearing payment session data..."),sessionStorage.removeItem("payment_item_name"),sessionStorage.removeItem("payment_total"),sessionStorage.removeItem("payment_order_id"),sessionStorage.removeItem("payment_customer_name"),sessionStorage.removeItem(`payment_uploaded_${j.orderId}`),localStorage.removeItem("pempek_cart_backup"),console.log("âœ… Payment data cleared")},F=async()=>{if(!o)return void A("Silakan pilih gambar bukti pembayaran terlebih dahulu");if(!j.orderId)return void A("Order ID tidak ditemukan. Silakan pesan ulang.");try{w(!0),A(null),console.log("ðŸ”„ Starting compression...");let a=await ((a,b=1200,c=.8)=>new Promise((d,e)=>{let f=new FileReader;f.onload=f=>{let g=new Image;g.onload=()=>{let f=document.createElement("canvas"),h=g.width,i=g.height;h>i?h>b&&(i=i*b/h,h=b):i>b&&(h=h*b/i,i=b),f.width=h,f.height=i;let j=f.getContext("2d");if(!j)return void e(Error("Failed to get canvas context"));j.imageSmoothingEnabled=!0,j.imageSmoothingQuality="high",j.drawImage(g,0,0,h,i);let k=f.toDataURL("image/jpeg",c);3*k.length/4/1024>800&&c>.5&&(console.log("ðŸ“‰ File still large, recompressing with lower quality..."),k=f.toDataURL("image/jpeg",c-.2));let l=3*k.length/4/1024,m=a.size/1024;console.log("ðŸ“Š Compression Summary:"),console.log("  Original:",m.toFixed(2),"KB"),console.log("  Compressed:",l.toFixed(2),"KB"),console.log("  Saved:",((m-l)/m*100).toFixed(1),"%"),console.log("  Dimensions:",h,"x",i),d(k)},g.onerror=()=>e(Error("Failed to load image")),g.src=f.target?.result},f.onerror=()=>e(Error("Failed to read file")),f.readAsDataURL(a)}))(o,1200,.8),b=3*a.length/4/1024;if(console.log("ðŸ“¤ Uploading",b.toFixed(2),"KB to server..."),b>2e3)throw Error("Gambar terlalu besar setelah kompresi.");await f.orderAPI.uploadPaymentProof(j.orderId,a),sessionStorage.setItem(`payment_uploaded_${j.orderId}`,"true"),y(!0),A(null),alert("âœ… Bukti pembayaran berhasil diupload!")}catch(a){console.error("Upload error:",a),A(a.message||"Terjadi kesalahan saat mengupload"),alert("Gagal mengupload bukti pembayaran")}finally{w(!1)}};return(0,c.useEffect)(()=>()=>{t&&t.startsWith("blob:")&&URL.revokeObjectURL(t)},[t]),(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100",children:[(0,b.jsx)(d.default,{}),(0,b.jsx)("div",{className:"pt-20 min-h-screen py-16 mt-6",children:(0,b.jsx)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl p-8 sm:p-12",children:[(0,b.jsx)(h,{onBack:D,orderId:j.orderId}),(0,b.jsx)(i,{itemName:j.itemName,totalPrice:j.totalPrice,formatPrice:C}),(0,b.jsx)(l,{orderId:j.orderId}),(0,b.jsx)(p,{proofUploaded:x,proofPreview:t,uploading:v,uploadError:z,onImageSelect:a=>{let b=a.target.files?.[0];if(b){if(A(null),!b.type.startsWith("image/"))return void A("File harus berupa gambar (JPG, PNG, dll)");if(b.size>0xa00000)return void A("Ukuran file maksimal 10MB. Silakan pilih gambar yang lebih kecil.");console.log("File selected:",b.name),q(b),u(URL.createObjectURL(b))}},onUploadProof:F,onRemoveImage:()=>{t&&t.startsWith("blob:")&&URL.revokeObjectURL(t),q(null),u(null),A(null)}}),(0,b.jsx)(r,{onWhatsAppConfirm:()=>{x||sessionStorage.getItem(`payment_uploaded_${j.orderId}`),sessionStorage.setItem("payment_method","whatsapp"),setTimeout(()=>{a.push("/payment-validasi?status=pending")},1e3)},onDirectContinue:()=>{x||sessionStorage.getItem(`payment_uploaded_${j.orderId}`),sessionStorage.setItem("payment_method","upload"),a.push("/payment-validasi?status=pending")},proofUploaded:x}),(0,b.jsx)(s,{totalPrice:j.totalPrice,formatPrice:C})]})})})]})}function u(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading payment..."})]})}),children:(0,b.jsx)(t,{})})}a.s(["default",()=>u],20864)}];

//# sourceMappingURL=app_app_%28customer%29_payment_page_tsx_c049b542._.js.map